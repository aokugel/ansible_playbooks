--- # Bootstrap Webservers
- hosts: webservers
  tasks:
  - name: Git pull from remote repo
    block:
     - name: get stuff from git
       git:
         repo: https://github.com/aokugel/Django-Blog-Website.git
         dest: /home/ubuntu/projects/mysite
         clone: no
         update: yes
     - name: run makemigrations
       django_manage:
         command: makemigrations
         app_path: /home/ubuntu/projects/mysite
         virtualenv: /home/ubuntu/projects/django_venv
    become: true
    become_user: ubuntu
  - name: cycle services
    block:
    - name: cycle gunicorn
      service:
        name: gunicorn
        state: restarted
    - name: cycle nginx
      service:
        name: nginx
        state: restarted
    become: true
